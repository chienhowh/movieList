{"version":3,"sources":["./src/app/core/services/watchlist.service.ts","./src/app/movie-list/watchlist/comment/comment.component.ts","./src/app/movie-list/watchlist/comment/comment.component.html","./src/app/movie-list/watchlist/watchlist-routing.module.ts","./src/app/movie-list/watchlist/watchlist.component.ts","./src/app/movie-list/watchlist/watchlist.component.html","./src/app/movie-list/watchlist/watchlist.module.ts"],"names":[],"mappings":"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","file":"movie-list-watchlist-watchlist-module.js","sourcesContent":["import { MovieRequestService } from './movie-request.service';\nimport { Injectable } from '@angular/core';\nimport { Observable } from 'rxjs';\nimport { API } from 'src/app/movie-list/consts/global-constants.const';\nimport { IWatchedMovie } from 'src/app/movie-list/watchlist/shared/watchlist';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WatchlistService {\n\n  constructor(\n    private requestService: MovieRequestService\n  ) { }\n\n\n\n  /** 取得ＤＢ所有電影紀錄 */\n  getWatchLists(): Observable<IWatchedMovie[]> {\n    return this.requestService.dbRequest(API.GET, API.WATCHLIST);\n  }\n\n  /**\n  * 從DB拿單筆電影\n  */\n  getWatchById(id: number): Observable<any> {\n    return this.requestService.dbRequest(API.GET, API.WATCHLIST + '/' + id);\n  }\n}\n","import { NzTreeNodeOptions } from 'ng-zorro-antd/tree';\nimport { NzModalRef } from 'ng-zorro-antd/modal';\nimport { DetailService } from './../../homepage/shared/detail.service';\nimport { IWatchedMovie, WATCHLIST_TYPE } from './../shared/watchlist';\nimport { Component, Input, OnInit } from '@angular/core';\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\n@Component({\n  selector: 'app-comment',\n  templateUrl: './comment.component.html',\n  styleUrls: ['./comment.component.scss']\n})\nexport class CommentComponent implements OnInit {\n  @Input() movie: IWatchedMovie;\n  /** 評論(new) or 看紀錄(read) */\n  @Input() type: string;\n  validateForm: FormGroup = this.fb.group({\n    watchedDate: [new Date(), Validators.required],\n    comment: ['', Validators.required]\n  });\n\n  constructor(\n    private fb: FormBuilder,\n    private detailService: DetailService,\n    public modalRef: NzModalRef,\n  ) { }\n\n  ngOnInit(): void {\n    if (this.type === WATCHLIST_TYPE.READ) {\n      this.validateForm.patchValue({ ...this.movie });\n      this.validateForm.disable();\n    }\n  }\n\n  /**\n   * 更新電影狀態\n   * @id\n   */\n  submitForm(): void {\n    const formControls = this.validateForm.controls;\n    for (const i in formControls) {\n      if (formControls.hasOwnProperty(i)) {\n        formControls[i].markAsDirty();\n        formControls[i].updateValueAndValidity();\n      }\n    }\n    console.log(this.validateForm);\n\n    if (this.validateForm.invalid) { return; }\n    if (this.type === WATCHLIST_TYPE.READ) {\n      this.modalRef.triggerOk();\n    }\n    const value = this.validateForm.value;\n    this.detailService.patchMovie(this.movie.id, { beenWatched: true, ...value }).subscribe(() =>\n      this.modalRef.triggerOk()\n    );\n  }\n}\n","<h4 class=\"text-center\">{{ movie.title }}</h4>\n<form nz-form class=\"form\" [formGroup]=\"validateForm\">\n  <div class=\"row\">\n    <div class=\"col-12\">\n      <nz-form-item>\n        <nz-form-label [nzSpan]=\"6\" nzRequired>觀影日期</nz-form-label>\n        <nz-form-control [nzSpan]=\"14\" nzErrorTip=\"請選擇觀看日期!\">\n          <nz-date-picker formControlName=\"watchedDate\" style=\"width: 100%;max-width: 400px;\"></nz-date-picker>\n        </nz-form-control>\n      </nz-form-item>\n    </div>\n    <div class=\"col-12\">\n      <nz-form-item>\n        <nz-form-label [nzSpan]=\"6\" nzRequired>觀影心得</nz-form-label>\n        <nz-form-control [nzSpan]=\"14\" nzErrorTip=\"寫些心得吧!\">\n          <textarea [nzAutosize]=\"{ minRows: 4, maxRows: 8 }\" nz-input formControlName=\"comment\" style=\"width: 100%;max-width: 400px;\"></textarea>\n        </nz-form-control>\n      </nz-form-item>\n    </div>\n  </div>\n</form>\n<div class=\"text-center\">\n  <button nz-button nzType=\"primary\" class=\"mr-3\" (click)=\"submitForm()\">\n    確認\n  </button>\n  <button nz-button nzType=\"primary\" nzDanger (click)=\"modalRef.close()\">\n    取消\n  </button>\n</div>\n","import { WatchlistComponent } from './watchlist.component';\nimport { RouterModule, Routes } from '@angular/router';\nimport { NgModule } from '@angular/core';\n\nconst routes: Routes = [\n  { path: '', component: WatchlistComponent }\n]\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule]\n})\nexport class WatchlistRoutingModule {\n\n}\n","import { WatchlistService } from './../../core/services/watchlist.service';\nimport { NzModalService } from 'ng-zorro-antd/modal';\nimport { CommentComponent } from './comment/comment.component';\nimport { DetailService } from './../homepage/shared/detail.service';\nimport { API_POSTER } from './../consts/global-constants.const';\nimport { Component, OnInit } from '@angular/core';\nimport { IWatchedMovie, WATCHLIST_TYPE } from './shared/watchlist';\nimport { NzFormatEmitEvent, NzTreeNodeOptions } from 'ng-zorro-antd/tree';\n\n@Component({\n  selector: 'app-watchlist',\n  templateUrl: './watchlist.component.html',\n  styleUrls: ['./watchlist.component.scss']\n})\nexport class WatchlistComponent implements OnInit {\n  API_POSTER = API_POSTER;\n\n  /**\n   * 待播清單\n   */\n  displayList: {\n    unWatchedList: IWatchedMovie[],\n    watchedList: IWatchedMovie[]\n  } = {\n      unWatchedList: [],\n      watchedList: []\n    };\n\n\n  tabList = [\n    { title: '尚未觀看', list: 'unWatchedList', type: WATCHLIST_TYPE.NEW },\n    { title: '已經觀看', list: 'watchedList', type: WATCHLIST_TYPE.READ }\n  ];\n\n  constructor(\n    private watchlistService: WatchlistService,\n    private detailService: DetailService,\n    private modalService: NzModalService\n  ) { }\n\n  ngOnInit(): void {\n    this.getWatchList();\n  }\n\n\n\n  getWatchList(): void {\n    this.watchlistService.getWatchLists().subscribe(res => {\n      // 先轉treenode\n      const treeNodes = res.map((movie: IWatchedMovie) => ({ ...movie, key: movie.id, isLeaf: true }));\n      this.displayList.watchedList = treeNodes.filter(movie => movie.beenWatched);\n      this.displayList.unWatchedList = treeNodes.filter(movie => !movie.beenWatched);\n    });\n  }\n\n\n  onPositiveClick(movie: IWatchedMovie, type: string): void {\n\n    this.modalService.create({\n      nzContent: CommentComponent,\n      nzComponentParams: { movie, type },\n      nzFooter: null,\n      nzBodyStyle: { padding: '24px' },\n      nzOnOk: () => {\n        this.getWatchList();\n      }\n    });\n  }\n\n\n  removeList(id: number, event: Event): void {\n    event.stopPropagation();\n    this.detailService.removeList(id).subscribe(() => this.getWatchList());\n  }\n\n  nzEvent(event: NzFormatEmitEvent, type: string): void {\n    // 電影資料\n    const movie = event.node.origin as unknown as IWatchedMovie;\n    this.onPositiveClick(movie, type);\n\n  }\n}\n","<div class=\"card-container\">\n  <nz-tabset nzType=\"card\">\n    <ng-container *ngFor=\"let tab of tabList\">\n      <nz-tab [nzTitle]=\"tab.title\">\n        <nz-tree\n          [nzData]=\"displayList[tab.list]\"\n          nzDraggable\n          (nzClick)=\"nzEvent($event, tab.type)\"\n        ></nz-tree>\n\n        <!-- <span class=\"close\" (click)=\"removeList(item.id, $event)\">x</span> -->\n      </nz-tab>\n    </ng-container>\n  </nz-tabset>\n</div>\n","import { SharedModule } from './../../shared/shared.module';\n\nimport { WatchlistComponent } from './watchlist.component';\n\nimport { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { WatchlistRoutingModule } from './watchlist-routing.module';\nimport { CommentComponent } from './comment/comment.component'\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\n@NgModule({\n  declarations: [\n    WatchlistComponent,\n    CommentComponent,\n  ],\n  imports: [\n    CommonModule,\n    WatchlistRoutingModule,\n    ReactiveFormsModule,\n    FormsModule,\n    SharedModule\n  ]\n})\nexport class WatchlistModule { }\n"],"sourceRoot":"webpack:///"}